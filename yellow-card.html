<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>迎新黃卡大廳</title>
  <style>
    :root {
      --bg-top: #fff7d6;
      --bg-bottom: #ffd166;
      --panel: rgba(255, 255, 255, 0.94);
      --panel-strong: #ffffff;
      --text-strong: #1d1b16;
      --text-soft: #5f5538;
      --accent: #ef476f;
      --accent-soft: rgba(239, 71, 111, 0.16);
      --shadow: 0 30px 70px rgba(239, 71, 111, 0.18);
      font-family: "Noto Sans TC", "Microsoft JhengHei", system-ui, sans-serif;
      color-scheme: light;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(160deg, var(--bg-top) 0%, var(--bg-bottom) 55%, #f77f00 100%);
      color: var(--text-strong);
      display: flex;
      flex-direction: column;
    }

    .page {
      flex: 1;
      display: grid;
      gap: 2rem;
      padding: clamp(1.5rem, 5vw, 3.5rem);
    }

    header.hero {
      background: var(--panel);
      border-radius: 26px;
      padding: clamp(1.8rem, 5vw, 3rem);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    header.hero h1 {
      margin: 0;
      font-size: clamp(2.2rem, 5vw, 3.2rem);
      letter-spacing: .08em;
    }

    .ghost-link {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: .6rem 1rem;
      border-radius: 18px;
      border: 1px solid rgba(23, 33, 43, .15);
      text-decoration: none;
      color: inherit;
      background: rgba(255, 255, 255, .7);
      font-weight: 600;
    }

    main {
      display: grid;
      gap: clamp(1.6rem, 4vw, 2.2rem);
    }

    section.panel {
      background: var(--panel);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: clamp(1.6rem, 4vw, 2.6rem);
      display: grid;
      gap: 1.6rem;
    }

    .lobby {
      display: grid;
      gap: 1.4rem;
    }

    .supply-card {
      background: var(--panel-strong);
      border-radius: 18px;
      padding: clamp(1.2rem, 3vw, 1.8rem);
      box-shadow: var(--shadow);
      display: grid;
      gap: 1rem;
    }

    .supply-header { display: flex; justify-content: space-between; align-items: center; gap: .8rem; flex-wrap: wrap; }
    .deck-modal { max-width: min(720px, 100%); gap: 1.4rem; }
    .deck-columns { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    .deck-list { list-style: none; margin: 0; padding: 0; display: grid; gap: .6rem; max-height: 260px; overflow: auto; }
    .deck-item { display: flex; justify-content: space-between; align-items: center; gap: .6rem; padding: .6rem .75rem; border-radius: 12px; background: rgba(23,33,43,.06); }
    .deck-empty { color: var(--text-soft); font-style: italic; }
    .deck-remove { white-space: nowrap; }

    .supply-form {
      display: grid;
      gap: .75rem;
      grid-template-columns: minmax(0, 1fr) auto;
      align-items: center;
    }

    .supply-form input {
      font: inherit;
      padding: .6rem .85rem;
      border-radius: 12px;
      border: 1px solid rgba(23, 33, 43, .16);
      background: rgba(255, 255, 255, .95);
    }

    button {
      font: inherit;
      cursor: pointer;
      border: none;
      border-radius: 999px;
      padding: .6rem 1.2rem;
      font-weight: 600;
      transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease;
    }

    .primary { background: var(--accent); color: #fff; }
    .ghost { background: rgba(255, 255, 255, .75); color: var(--text-strong); border: 1px solid rgba(23,33,43,.12); }
    .ghost:hover { background: rgba(255,255,255,.95); }

    .rooms-grid {
      display: grid;
      gap: 1.2rem;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .room-card {
      background: var(--panel-strong);
      border-radius: 18px;
      padding: 1.2rem 1.4rem;
      box-shadow: var(--shadow);
      display: grid;
      gap: .8rem;
    }

    .room-card h3 { margin: 0; }
    .room-meta { display: grid; gap: .3rem; color: var(--text-soft); font-size: .92rem; }

    #room-panel.hidden { display: none; }
    #hand-card.hidden { display: none; }

    .room-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
    }

    .status-stack { display: grid; gap: .4rem; }
    .badge, .pill { display: inline-flex; align-items: center; padding: .25rem .75rem; border-radius: 999px; }
    .badge { background: var(--accent-soft); color: var(--accent); font-weight: 600; }
    .pill { background: rgba(23,33,43,.08); }
    .pill.danger { background: rgba(239,71,111,.15); color: var(--accent); }

    table.player-table { width: 100%; border-collapse: collapse; font-size: .92rem; }
    table.player-table th, table.player-table td { padding: .6rem .4rem; border-bottom: 1px solid rgba(23,33,43,.12); text-align: left; }
    table.player-table th { background: rgba(255,255,255,.5); font-weight: 600; }

    .table-actions { display: flex; flex-wrap: wrap; gap: .4rem; }

    #activity-log { list-style: none; margin: 0; padding: 0; display: grid; gap: .6rem; }
    #activity-log .card { background: rgba(255,255,255,.85); border-radius: 12px; padding: .65rem .8rem; box-shadow: inset 0 0 0 1px rgba(23,33,43,.08); display: grid; gap: .3rem; }

    .topic-card { background: rgba(255,255,255,.85); border-radius: 14px; padding: 1rem 1.2rem; box-shadow: inset 0 0 0 1px rgba(23,33,43,.08); }
    .topic-card h4 { margin: 0 0 .5rem; letter-spacing: .08em; color: var(--text-soft); }

    .topic-blank { display: inline-flex; align-items: center; padding: 0 .4rem; border-bottom: 2px dashed rgba(239,71,111,.6); cursor: pointer; transition: background-color .2s ease; }
    .topic-blank.filled { background: var(--accent-soft); }
    .topic-blank:hover { background: rgba(239,71,111,.18); }

    /* candidate visual for selected hand card */
    #hand-list li.card.candidate {
      outline: 3px solid var(--accent);
      box-shadow: 0 8px 30px rgba(239,71,111,.12);
      transform: translateY(-2px);
    }

    #hand-card .card { background: var(--panel-strong); border-radius: 16px; padding: 1.2rem; box-shadow: var(--shadow); }
    #hand-list { list-style: none; margin: 1rem 0 0; padding: 0; display: grid; gap: .6rem; }
    #hand-list .card { background: rgba(255,255,255,.85); border-radius: 12px; padding: .65rem .8rem; box-shadow: inset 0 0 0 1px rgba(23,33,43,.1); }

    .hidden { display: none !important; }

    #toast { position: fixed; left: 50%; bottom: 1.8rem; transform: translateX(-50%) translateY(160%); background: rgba(17,24,39,.92); color:#fff; padding:.6rem 1.2rem; border-radius:999px; font-size:.95rem; transition: transform .28s ease, opacity .28s ease; opacity:0; }
    #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    .modal-backdrop { position: fixed; inset: 0; background: rgba(17,24,39,.45); display: none; place-items: center; padding: 1.5rem; z-index: 40; }
    .modal-backdrop:not(.hidden) { display: grid; }
    .modal { background: #fff; border-radius: 20px; padding: clamp(1.6rem, 5vw, 2.2rem); width: min(420px, 100%); display: grid; gap: 1rem; box-shadow: var(--shadow); }
    .modal label { display: grid; gap: .4rem; font-weight: 600; }
    .modal input { font: inherit; padding: .7rem .9rem; border-radius: 12px; border: 1px solid rgba(17,24,39,.18); }
    .modal-actions { display: flex; justify-content: flex-end; gap: .6rem; }

    @media (max-width: 720px) {
      .supply-form { grid-template-columns: 1fr; }
      .room-header { flex-direction: column; align-items: stretch; }
      table.player-table th, table.player-table td { font-size: .85rem; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="hero">
      <h1>活動大廳</h1>
    </header>

    <main>
      <section class="panel" id="lobby-panel">
        <div class="lobby">
          <div class="supply-card">
            <div class="supply-header">
              <h2 style="margin:0">補給牌庫</h2>
              <button id="btn-open-deck-manager" class="ghost" type="button">管理牌庫</button>
            </div>
            <p class="subtext" style="margin:0;color:var(--text-soft);">新增卡片會同步到所有房間的牌庫，並自動加入後備清單。</p>
            <div class="supply-form">
              <input id="input-new-word" type="text" maxlength="32" placeholder="輸入新的黃卡字詞">
              <button id="btn-add-word" class="primary" type="button">新增黃卡</button>
              <input id="input-new-topic" type="text" maxlength="80" placeholder="輸入新的紫卡題目">
              <button id="btn-add-topic" class="ghost" type="button">新增紫卡</button>
            </div>
          </div>

          <div class="rooms-grid" id="room-grid"></div>
        </div>
      </section>

      <section class="panel hidden" id="room-panel">
        <div class="room-header">
          <div class="status-stack">
            <div id="room-name" class="badge">房間名稱</div>
            <div id="room-capacity" class="pill">0 / 0 人在線</div>
            <div id="room-judge" class="pill">裁判：待指定</div>
          </div>
          <div class="room-actions" style="gap:.6rem;align-items:flex-end;">
            <button id="btn-back" class="ghost" type="button">返回大廳</button>
            <button id="btn-leave" class="ghost" type="button">離開房間</button>
          </div>
        </div>

        <div style="display:flex;flex-wrap:wrap;gap:.6rem;">
          <button id="btn-toggle-ready" class="primary" type="button">我準備好了</button>
          <button id="btn-start-game" class="primary hidden" type="button">開始遊戲</button>
          <button id="btn-reset-ready" class="ghost" type="button">重設狀態</button>
        </div>

        <div style="display:grid;gap:1.4rem;">
          <div style="overflow-x:auto;background:var(--panel-strong);border-radius:16px;padding:1rem;box-shadow:var(--shadow);">
            <h3 style="margin-top:0;">玩家列表</h3>
            <table class="player-table">
              <thead>
                <tr>
                  <th>玩家</th>
                  <th>身份</th>
                  <th>黃牌</th>
                  <th>手牌</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="player-tbody">
                <tr><td colspan="6" style="text-align:center;color:var(--text-soft);padding:1rem;">尚未有玩家加入</td></tr>
              </tbody>
            </table>
          </div>

          <div style="display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));">
            <div class="topic-card">
              <h4>目前題目</h4>
              <p id="current-topic">尚未抽題</p>
              <span id="topic-remaining" class="pill">剩餘題目：--</span>
              <p style="margin-top:.8rem;color:var(--text-soft);font-size:.9rem;">題目會在遊戲開始、給黃牌或輪換裁判時自動抽換。</p>
            </div>
            <div style="background:var(--panel-strong);border-radius:16px;padding:1rem;box-shadow:var(--shadow);">
              <h3 style="margin-top:0;">活動紀錄</h3>
              <ul id="activity-log" style="max-height:240px;overflow:auto;"></ul>
            </div>
          </div>
        </div>
      </section>

      <section class="panel hidden" id="hand-card">
        <h2 style="margin-top:0;">我的黃卡</h2>
        <div class="card">
          <div style="display:flex;align-items:center;gap:.8rem;flex-wrap:wrap;">
            <h3 style="margin:0;">手牌數</h3>
            <span id="hand-count" class="badge">0 張</span>
          </div>
          <div id="discard-toolbar" class="subtext hidden" style="margin-top:.8rem;display:flex;align-items:center;gap:.6rem;flex-wrap:wrap;color:var(--text-soft);">
            <span id="discard-status"></span>
            <button type="button" class="ghost" id="btn-toggle-discard">選擇棄牌</button>
          </div>
          <div id="hand-empty" class="subtext" style="margin-top:.8rem;color:var(--text-soft);">目前沒有黃卡。</div>
              <ul id="hand-list"></ul>
              <!-- Submit form for playing a card (select removed — choose by clicking a hand card) -->
              <form id="submit-form" style="margin-top:.8rem;display:flex;gap:.6rem;align-items:center;">
                <button type="button" id="btn-confirm-play" class="primary">確定出牌</button>
              </form>
        </div>
      </section>
    </main>
  </div>

  <footer class="page-footer">
    <a class="ghost-link" href="https://wanganan25.github.io/secertmisson/">返回主頁</a>
  </footer>

  <div class="modal-backdrop hidden" id="deck-dialog" role="dialog" aria-modal="true">
    <div class="modal deck-modal">
      <h2>牌庫管理</h2>
      <p class="subtext" style="margin:0;color:var(--text-soft);">所有房間共用同一份黃卡與紫卡。移除後僅影響補給牌堆，玩家手牌不會即時回收。</p>
      <div class="deck-columns">
        <section>
          <h3>黃卡</h3>
          <ul class="deck-list" id="deck-word-list"></ul>
        </section>
        <section>
          <h3>紫卡</h3>
          <ul class="deck-list" id="deck-topic-list"></ul>
        </section>
      </div>
      <div class="modal-actions">
        <button type="button" class="ghost" id="btn-close-deck">關閉</button>
      </div>
    </div>
  </div>

  <!-- Confirm submit modal (needed by app-yellow.js) -->
  <div class="modal-backdrop hidden" id="confirm-submit-backdrop" role="presentation">
    <div class="modal" id="confirm-submit-modal" aria-modal="true" aria-labelledby="confirm-submit-title">
      <h2 id="confirm-submit-title">確認出牌</h2>
      <p id="confirm-submit-preview" style="line-height:1.6;color:var(--text-soft);"></p>
      <div style="display:flex;gap:.6rem;justify-content:flex-end;">
        <button type="button" class="ghost" id="confirm-submit-cancel">取消</button>
        <button type="button" class="primary" id="confirm-submit-ok">確定出牌</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop hidden" id="join-dialog" role="dialog" aria-modal="true">
    <form class="modal" id="join-form" aria-labelledby="join-form-title">
      <h2 id="join-form-title">加入房間</h2>
      <p id="join-room-name" class="subtext" style="margin:0;color:var(--text-soft);"></p>
      <p id="join-form-hint" style="margin:0;color:var(--text-soft);font-size:.9rem;">輸入暱稱即可加入，已在其他房間的話會自動移動過來。</p>
      <label for="nickname-input">暱稱
        <input id="nickname-input" name="nickname" maxlength="16" autocomplete="off" required>
      </label>
      <p class="error-text hidden" id="join-error" role="alert"></p>
      <div class="modal-actions">
        <button type="button" class="ghost" id="btn-cancel-join">取消</button>
        <button type="button" class="primary" id="btn-confirm-join">加入房間</button>
      </div>
    </form>
  </div>

  <div id="toast" role="status" aria-live="polite"></div>

  <script type="module" src="./app-yellow.js"></script>
</body>
</html>
